<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>AdminLTE | Flot Charts</title>
        <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
        <!-- bootstrap 3.0.2 -->
        <link href="../../css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <!-- font Awesome -->
        <link href="../../css/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <!-- Ionicons -->
        <link href="../../css/ionicons.min.css" rel="stylesheet" type="text/css" />
		<!-- Morris chart -->
        <link href="../../css/morris/morris.css" rel="stylesheet" type="text/css" />
        <!-- jvectormap -->
        <link href="../../css/jvectormap/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css" />
        <!-- fullCalendar -->
        <link href="../../css/fullcalendar/fullcalendar.css" rel="stylesheet" type="text/css" />
        <!-- Daterange picker -->
        <link href="../../css/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" />
        <!-- bootstrap wysihtml5 - text editor -->
        <link href="../../css/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" rel="stylesheet" type="text/css" />
        <!-- Theme style -->
        <link href="../../css/AdminLTE.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="normalize.css">
        <style>
          .legend {                                                   /* NEW */
            font-size: 12px;                                          /* NEW */
          }                                                           /* NEW */
          rect {                                                      /* NEW */
            stroke-width: 2;                                          /* NEW */
          }                                                           /* NEW */
        </style>
		<!--<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
		<script src="http://cdn.crunchify.com/wp-content/uploads/code/knob.js"></script>
		-->

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
          <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="http://jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
		
		
    </head>
    <body class="skin-blue">
        <!-- header logo: style can be found in header.less -->
        <header class="header">
            <a href="../../flot.html" class="logo">
                <!-- Add the class icon to your logo image or logo icon to add the margining -->
                Data Analytics
            </a>
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top" role="navigation">
               
                <div class="navbar-right">
                    <ul class="nav navbar-nav">
                       
                        <!-- User Account: style can be found in dropdown.less -->
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="glyphicon glyphicon-user"></i>
                                <span>Administrator <i class="caret"></i></span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header bg-light-blue">
                                    <img src="../../img/avatar3.png" class="img-circle" alt="User Image" />
                                    <p>
                                        Administrator
                                        
                                    </p>
                                </li>
                                <!-- Menu Body -->
                               
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a href="#" class="btn btn-default btn-flat">Profile</a>
                                    </div>
                                    <div class="pull-right">
                                        <a href="#" class="btn btn-default btn-flat">Sign out</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <div class="wrapper row-offcanvas row-offcanvas-left">
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="left-side sidebar-offcanvas">
                <!-- sidebar: style can be found in sidebar.less -->
                <section class="sidebar">
                   
                    <ul class="sidebar-menu">
                        <li>
                            <a href="./flot.html">
                                <i class="fa fa-dashboard"></i> <span>Dashboard</span>
                            </a>
                        </li>
                       
                        </li>
                       
                    </ul>
                </section>
                <!-- /.sidebar -->
            </aside>

            <!-- Right side column. Contains the navbar and content of the page -->
            <aside class="right-side">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        Dashboard
                    </h1>
                </section>

                <!-- Main content -->
                <section class="content">
				<div class="row">
                        <div class="col-lg-3 col-xs-6">
                            <!-- small box -->
                            <div class="small-box bg-aqua">
                                <div class="inner">
                                    <h3>
                                        <p id="minitem"></p>
                                    </h3>
                                    <p>
                                        <b>LEAST</b> frequently clicked item
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!-- ./col -->
                        <div class="col-lg-3 col-xs-6">
                            <!-- small box -->
                            <div class="small-box bg-green">
                                <div class="inner">
                                    <h3>
                                        <p id="maxitem"></p></h3>
                                    <p>
                                        <b>MOST</b> frequently clicked item
                                    </p>
                                </div>
                          </div>
                        </div>
                        <!-- ./col -->
                        <div class="col-lg-3 col-xs-6">
                            <!-- small box -->
                            <div class="small-box bg-yellow">
                                <div class="inner">
                                    <h3>
                                        <p id="bouncerate"></p>
                                    </h3>
                                    <p>
                                        <b>BOUNCE</b> rate                                    
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!-- ./col -->
                        <div class="col-lg-3 col-xs-6">
                            <!-- small box -->
                            <div class="small-box bg-red">
                                <div class="inner">
                                    <h3>
                                       <p id="frequentlylast"></p>
                                   </h3>
                                    <p>
                                        <b>LAST</b> frequently used item               
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!-- ./col -->
                  </div>
                   
                   

                    <div class="row">
                        <div class="col-md-6">
                            <!-- Line chart -->
                            <div class="box box-primary">
                                <div class="box-header">
                                    <i class="fa fa-bar-chart-o"></i>
                                    <h3 class="box-title">Bar chart representing TODAY's itemized clicks</h3>
                                </div>
                                <div class="box-body">
                                    <div id="line-chart" style="height: 300px;"></div>
                                </div><!-- /.box-body-->
                            </div><!-- /.box -->
                        </div>
                        <!-- /.col -->

                        <div class="col-md-6">
                            
                            <!-- Donut chart -->
                            <div class="box box-primary">
                                <div class="box-header">
                                    <i class="fa fa-bar-chart-o"></i>
                                    <h3 class="box-title">Total itemized clicks</h3>
                                </div>
                                <div class="box-body">
                                    <div id="donut-chart" style="height: 300px;"></div>
                                </div><!-- /.box-body-->
                            </div><!-- /.box -->
                        </div>
                        <!-- /.col -->
						
                    </div><!-- /.row -->
										
					
					
					
					
					<div class="row">
					<div class="col-lg-3 col-xs-6"></div>
							<div class="col-lg-3 col-xs-6">
									<!-- small box -->
									<div class="small-box bg-red">
                                    <div class="inner">
                                        <h3>
                                            <p id="incompletejourneys"></p>
                                        </h3>
                                        <p>
                                            Incomplete Journeys  
                                        </p>
                                    </div>
                                </div>
								</div>
                        <!-- ./col -->
							<div class="col-lg-3 col-xs-6">
								<!-- small box -->
								<div class="small-box bg-green">
									<div class="inner">
										<h3>
											<p id="completejourneys"></p>
										</h3>
										<p>
											Complete Journeys                                    
										</p>
									</div>
								</div>
							</div>
										<div class="col-lg-3 col-xs-6"></div>
					</div>
					
					
					
					
					
					
							
                </section><!-- /.content -->

            </aside><!-- /.right-side -->
        </div><!-- ./wrapper -->


        <!-- jQuery 2.0.2 -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
        <!-- Bootstrap -->
        <script src="../../js/bootstrap.min.js" type="text/javascript"></script>
		<!-- jQuery Knob Chart -->
        <script src="../../js/plugins/jqueryKnob/jquery.knob.js" type="text/javascript"></script>
        <!-- AdminLTE App -->
        <script src="../../js/AdminLTE/app.js" type="text/javascript"></script>
  		<!-- FLOT CHARTS -->
        <script src="../../js/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
        <!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized -->
        <script src="../../js/plugins/flot/jquery.flot.resize.min.js" type="text/javascript"></script>
        <!-- FLOT PIE PLUGIN - also used to draw donut charts -->
        <script src="../../js/plugins/flot/jquery.flot.pie.min.js" type="text/javascript"></script>
        <!-- FLOT CATEGORIES PLUGIN - Used to draw bar charts -->
        <script src="../../js/plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>
		
		
		
        <!-- Page script -->
        <script type="text/javascript">


             $(function() {

                
                
            //     /*
            //      * LINE CHART
            //      * ----------
            //      */
            //     //LINE randomly generated data

            //     var sin = [], cos = [];
            //     for (var i = 0; i < 14; i += 0.5) {
            //         sin.push([i, Math.sin(i)]);
            //         cos.push([i, Math.cos(i)]);
            //     }
            //     var line_data1 = {
            //         data: sin,
            //         color: "#3c8dbc"
            //     };
            //     var line_data2 = {
            //         data: cos,
            //         color: "#00c0ef"
            //     };
            //     $.plot("#line-chart", [line_data1, line_data2], {
            //         grid: {
            //             hoverable: true,
            //             borderColor: "#f3f3f3",
            //             borderWidth: 1,
            //             tickColor: "#f3f3f3"
            //         },
            //         series: {
            //             shadowSize: 0,
            //             lines: {
            //                 show: true
            //             },
            //             points: {
            //                 show: true
            //             }
            //         },
            //         lines: {
            //             fill: false,
            //             color: ["#3c8dbc", "#f56954"]
            //         },
            //         yaxis: {
            //             show: true,
            //         },
            //         xaxis: {
            //             show: true
            //         }
            //     });
            //     //Initialize tooltip on hover
            //     $("<div class='tooltip-inner' id='line-chart-tooltip'></div>").css({
            //         position: "absolute",
            //         display: "none",
            //         opacity: 0.8
            //     }).appendTo("body");
            //     $("#line-chart").bind("plothover", function(event, pos, item) {

            //         if (item) {
            //             var x = item.datapoint[0].toFixed(2),
            //                     y = item.datapoint[1].toFixed(2);

            //             $("#line-chart-tooltip").html(item.series.label + " of " + x + " = " + y)
            //                     .css({top: item.pageY + 5, left: item.pageX + 5})
            //                     .fadeIn(200);
            //         } else {
            //             $("#line-chart-tooltip").hide();
            //         }

            //     });
                /* END LINE CHART */

               

                /*
                 * DONUT CHART
                 * -----------
                 */

                
                /*
                 * END DONUT CHART
                 */

            });

            /*
             * Custom Label formatter
             * ----------------------
             */
            function labelFormatter(label, series) {
                return "<div style='font-size:13px; text-align:center; padding:2px; color: #fff; font-weight: 600;'>"
                        + label
                        + "<br/>"
                        + Math.round(series.percent) + "%</div>";
            }
        </script>
		
    </body>
</html>



<script>

var dat0;
var dat1;
var dat2;
var dat3;
d3.text('logrecord.csv', function(data){
    dat0 = d3.csv.parseRows(data);
    minUsedItem();
    maxUsedItem();
    bounceRate();
    frequentlyLastUsedItem();
    barChart();
    pieChart();
})


function minUsedItem(){
    
    var finArray = new Array();
    var finArray2 = new Array();
    var minItemPair = new Object();
    for(var i=1; i<=dat0.length-1;i++){
        
        finArray[i-1] = dat0[i][0];
    
    }
    var a = [], b = [], prev;

    finArray.sort();
    for ( var i = 0; i < finArray.length; i++ ) {
        if ( finArray[i] !== prev ) {
            a.push(finArray[i]);
            b.push(1);
        } else {
            b[b.length-1]++;
        }
        prev = finArray[i];
    }
    var min = b[0];
    var minItem=a[0];
    for(var i=1; i<b.length; i++){

        if(min>b[i]){
            minItem = a[i];
            min=b[i];
        }
    }
    $('#minitem').html('<h3>'+minItem+'</h3>');

}

function maxUsedItem(){
    
    var finArray = new Array();
    var finArray2 = new Array();
    var minItemPair = new Object();
    for(var i=1; i<=dat0.length-1;i++){
        
        finArray[i-1] = dat0[i][0];
    
    }
    var a = [], b = [], prev;

    finArray.sort();
    for ( var i = 0; i < finArray.length; i++ ) {
        if ( finArray[i] !== prev ) {
            a.push(finArray[i]);
            b.push(1);
        } else {
            b[b.length-1]++;
        }
        prev = finArray[i];
    }
    var max = b[0];
    var maxItem=a[0];
    for(var i=1; i<b.length; i++){

        if(max<b[i]){
            maxItem = a[i];
            max=b[i];
        }
    }
    $('#maxitem').html('<h3>'+maxItem+'</h3>');

}
function bounceRate(){

    console.log(dat0[1]);
    
    var complete = 0;
    var incomplete = 0;

    for(var i=1; i<dat0.length; i++){

     //   console.log("col5:"+dat0[i][5] + ",col6: " + dat0[i][6]);
        if(dat0[i][5]=='True' && dat0[i][6]=='END'){
            incomplete++;


        }
        if(dat0[i][5]=='False' && dat0[i][6]=='END'){

            complete++;
        }

    }

    var bounce = (incomplete/(incomplete+complete))*100;
   // console.log("incomplete:"+incomplete + ",complete: " + complete);
    $('#bouncerate').html('<h3>'+Math.round(bounce)+'%</h3>');
    $('#incompletejourneys').html('<h3>'+Math.round(bounce)+'%</h3>');
    $('#completejourneys').html('<h3>'+Math.round(100-bounce)+'%</h3>');
}
function pieChart(){
    console.log('***********************');
    //console.log(dat0);
    console.log('***********************');
    var finArray = [];
    var finArray2 = new Array();
    var minItemPair = new Object();
    //console.log(dat0.length);
    for(var i=1; i<=dat0.length-1;i++){
      //  console.log("dat0[i-1][2]:"+dat0[i-1][2].substring(1,11)+",dat0[i][2]:"+dat0[i][2]);
         finArray.push(dat0[i][0]);
        
    }
    console.log("fin bar chart:"+finArray)
    var a = [], b = [], prev;

    finArray.sort();
    for ( var i = 0; i < finArray.length; i++ ) {
        if ( finArray[i] !== prev ) {
            a.push(finArray[i]);
            b.push(1);
        } else {
            b[b.length-1]++;
        }
        prev = finArray[i];
    }
    console.log(a);
    console.log(b);
    var donutData = [];
    for(var i=0;i<a.length;i++){

        donutData.push({label: a[i], data: b[i]});
    }
    console.log(donutData[0])
        
                $.plot("#donut-chart", donutData, {
                    series: {
                        pie: {
                            show: true,
                            radius: 1,
                            innerRadius: 0,
                            label: {
                                show: true,
                                radius: 2 / 3,
                                formatter: labelFormatter,
                                threshold: 0.1
                            }

                        }
                    },
                    legend: {
                        show: true
                    }
                });
                /* END PIE CHART */
    

}

function barChart(){
    console.log('***********************');
    //console.log(dat0);
    console.log('***********************');
    var finArray = [];
    var finArray2 = new Array();
    var minItemPair = new Object();
    //console.log(dat0.length);
    for(var i=dat0.length-1; i>=2;i--){
      //  console.log("dat0[i-1][2]:"+dat0[i-1][2].substring(1,11)+",dat0[i][2]:"+dat0[i][2]);
        if(dat0[i-1][2].substring(1,11)==dat0[i][2].substring(1,11)){
           finArray.push(dat0[i-1][0]);
         //  console.log("fin bar chart:"+finArray);
        }
        else{
            finArray.push(dat0[i][0]);
            break;
        }
    
    }
    console.log("fin bar chart:"+finArray)
    var a = [], b = [], prev;

    finArray.sort();
    for ( var i = 0; i < finArray.length; i++ ) {
        if ( finArray[i] !== prev ) {
            a.push(finArray[i]);
            b.push(1);
        } else {
            b[b.length-1]++;
        }
        prev = finArray[i];
    }
    console.log(a);
    console.log(b);
    var bar_data = [];
    for(var i=0;i<a.length;i++){

        bar_data.push([a[i],b[i]]);
    }

        $.plot("#line-chart", [bar_data], {
        grid: {
            borderWidth: 1,
            borderColor: "#f3f3f3",
            tickColor: "#f3f3f3"
        },
        series: {
            bars: {
                show: true,
                barWidth: 0.5,
                align: "center"
            }
        },
        xaxis: {
            mode: "categories",
            tickLength: 0
        }
    });
                /* END BAR CHART */
    

}
function frequentlyLastUsedItem(){

   // console.log("....."+dat0[1]);
    
    var finArray = [];
    var finArray2 = new Array();
    
    for(var i=1; i<=dat0.length-1;i++){
        
        
        if(dat0[i][5]=='True' && dat0[i][6]=='END' ){
           
            finArray.push(dat0[i][0]);
        }
    
    }
    
   // console.log(finArray);

    var a = [], b = [], prev;

    finArray.sort();
    
    for ( var i = 0; i < finArray.length; i++ ) {
        if ( finArray[i] !== prev ) {
            a.push(finArray[i]);
            b.push(1);
        } else {
            b[b.length-1]++;
        }
       
        
        prev = finArray[i];
    }
    var max = b[0];
    var maxItem=a[0];
 //   console.log(a);
   // console.log(b);
    for(var i=0; i<b.length; i++){

        if(max<b[i]){
            maxItem = a[i];
            max=b[i];
        }

    }






    $('#frequentlylast').html('<h3>'+maxItem+'</h3>');
}

</script>